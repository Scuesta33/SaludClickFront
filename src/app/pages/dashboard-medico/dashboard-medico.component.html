<mat-sidenav-container class="sidenav-container">
  <mat-sidenav #sidenav [mode]="isScreenSmall ? 'over' : 'side'" [opened]="!isScreenSmall || sidenav.opened">
    <mat-toolbar color="primary">Menú</mat-toolbar>
    <mat-nav-list>
      <mat-list-item (click)="setActiveSection('crear-disponibilidades'); closeSidenavIfSmall()">
        <mat-icon matListIcon>event_available</mat-icon>
        <span matLine>Crear disponibilidades</span>
      </mat-list-item>
      <mat-list-item (click)="setActiveSection('visualizar-disponibilidades'); closeSidenavIfSmall()">
        <mat-icon matListIcon>view_list</mat-icon>
        <span matLine>Visualizar disponibilidades</span>
      </mat-list-item>
      <mat-list-item (click)="setActiveSection('modificar-citas'); closeSidenavIfSmall()">
        <mat-icon matListIcon>edit</mat-icon>
        <span matLine>Modificar citas</span>
      </mat-list-item>
      <mat-list-item (click)="setActiveSection('visualizar-consultas'); closeSidenavIfSmall()">
        <mat-icon matListIcon>visibility</mat-icon>
        <span matLine>Visualizar consultas</span>
      </mat-list-item>
      <mat-list-item (click)="setActiveSection('enviar-notificacion'); closeSidenavIfSmall()">
        <mat-icon matListIcon>notifications</mat-icon>
        <span matLine>Enviar Notificación</span>
      </mat-list-item>
      <mat-list-item (click)="setActiveSection('visualizar-notificaciones'); closeSidenavIfSmall()">
        <mat-icon matListIcon>notifications_active</mat-icon>
        <span matLine>Notificaciones Recibidas</span>
      </mat-list-item>
      <mat-list-item (click)="setActiveSection('datos-usuario'); closeSidenavIfSmall()">
        <mat-icon matListIcon>person</mat-icon>
        <span matLine>Datos del usuario</span>
      </mat-list-item>
      <mat-divider></mat-divider>
      <mat-list-item (click)="logout(); closeSidenavIfSmall()" class="logout">
        <mat-icon matListIcon>exit_to_app</mat-icon>
        <span matLine>Cerrar sesión</span>
      </mat-list-item>
    </mat-nav-list>
  </mat-sidenav>
  <mat-sidenav-content>
    <mat-toolbar color="primary">
      <button mat-icon-button (click)="sidenav.toggle()" class="menu-button">
        <mat-icon>menu</mat-icon>
      </button>
      Médico
      <span class="spacer"></span>
      <button mat-icon-button (click)="mostrarNotificaciones()">
        <mat-icon>notifications</mat-icon>
        <span *ngIf="notificacion.length" class="notification-badge">{{ notificacion.length }}</span>
      </button>
    </mat-toolbar>
    <div class="content">
      <div *ngIf="activeSection === 'enviar-notificacion'">
        <h2>Enviar Notificación</h2>
        <form [formGroup]="notificacionForm" (ngSubmit)="enviarNotificacion()">
          <mat-form-field>
            <mat-label>Asunto</mat-label>
            <input matInput formControlName="asunto">
          </mat-form-field>
          <mat-form-field>
            <mat-label>Nombre del Destinatario</mat-label>
            <input matInput formControlName="destinatarioNombre">
          </mat-form-field>
          <mat-form-field>
            <mat-label>Mensaje</mat-label>
            <textarea matInput formControlName="mensaje"></textarea>
          </mat-form-field>
          <button mat-raised-button color="primary" type="submit">Enviar</button>
        </form>
      </div>
      <div *ngIf="activeSection === 'visualizar-notificaciones'">
        <h2>Notificaciones</h2>
        <table mat-table [dataSource]="notificacionNueva" class="mat-elevation-z8">
          <ng-container matColumnDef="asunto">
            <th mat-header-cell *matHeaderCellDef> Asunto </th>
            <td mat-cell *matCellDef="let notification"> {{notification.asunto}} </td>
          </ng-container>
          <ng-container matColumnDef="mensaje">
            <th mat-header-cell *matHeaderCellDef> Mensaje </th>
            <td mat-cell *matCellDef="let notification"> {{notification.mensaje}} </td>
          </ng-container>
          <ng-container matColumnDef="remitente">
            <th mat-header-cell *matHeaderCellDef> Remitente </th>
            <td mat-cell *matCellDef="let notification"> {{notification.usuario.nombre}} </td>
          </ng-container>
          <ng-container matColumnDef="fecha">
            <th mat-header-cell *matHeaderCellDef> Fecha </th>
            <td mat-cell *matCellDef="let notification"> {{notification.fechaEnvio | date}} </td>
          </ng-container>
          <ng-container matColumnDef="acciones">
            <th mat-header-cell *matHeaderCellDef> Acciones </th>
            <td mat-cell *matCellDef="let notification">
              <button mat-button color="warn" (click)="deleteNotificacion(notification.idNotificacion)">Eliminar</button>
            </td>
          </ng-container>
          <tr mat-header-row *matHeaderRowDef="columnaNotificaciones"></tr>
          <tr mat-row *matRowDef="let row; columns: columnaNotificaciones;"></tr>
        </table>
      </div>
      <div *ngIf="activeSection === 'crear-disponibilidades'">
        <h2>Crear disponibilidades</h2>
        <form [formGroup]="disponibilidadForm" (ngSubmit)="crearDisponibilidad()">
          <mat-form-field>
            <mat-label>Día de la Semana</mat-label>
            <mat-select formControlName="diaSemana">
              <mat-option *ngFor="let dia of diasSemana" [value]="dia">{{ dia }}</mat-option>
            </mat-select>
          </mat-form-field>
          <mat-form-field>
            <mat-label>Hora de Inicio</mat-label>
            <input matInput formControlName="horaInicio" type="time">
          </mat-form-field>
          <mat-form-field>
            <mat-label>Hora de Fin</mat-label>
            <input matInput formControlName="horaFin" type="time">
          </mat-form-field>
          <button mat-raised-button color="primary" type="submit">Crear Disponibilidad</button>
        </form>
      </div>
      <div *ngIf="activeSection === 'visualizar-disponibilidades'">
        <h2>Visualizar disponibilidades</h2>
        <table mat-table [dataSource]="disponibilidades" class="mat-elevation-z8">
          <ng-container matColumnDef="diaSemana">
            <th mat-header-cell *matHeaderCellDef> Día de la Semana </th>
            <td mat-cell *matCellDef="let disponibilidad"> {{disponibilidad.diaSemana}} </td>
          </ng-container>
          <ng-container matColumnDef="horaInicio">
            <th mat-header-cell *matHeaderCellDef> Hora de Inicio </th>
            <td mat-cell *matCellDef="let disponibilidad"> {{disponibilidad.horaInicio}} </td>
          </ng-container>
          <ng-container matColumnDef="horaFin">
            <th mat-header-cell *matHeaderCellDef> Hora de Fin </th>
            <td mat-cell *matCellDef="let disponibilidad"> {{disponibilidad.horaFin}} </td>
          </ng-container>
          <ng-container matColumnDef="acciones">
            <th mat-header-cell *matHeaderCellDef> Acciones </th>
            <td mat-cell *matCellDef="let disponibilidad">
              <button mat-button color="warn" (click)="deleteDisponibilidad(disponibilidad.idDisponibilidad)">Eliminar</button>
            </td>
          </ng-container>
          <tr mat-header-row *matHeaderRowDef="mostrarDisponibilidades"></tr>
          <tr mat-row *matRowDef="let row; columns: mostrarDisponibilidades;"></tr>
        </table>
      </div>
      <div *ngIf="activeSection === 'modificar-citas'">
        <h2>Modificar cita</h2>
        <form [formGroup]="modificarCitaForm" (ngSubmit)="modificarCitas()">
          <mat-form-field appearance="fill">
            <mat-label>ID de la Cita</mat-label>
            <input matInput formControlName="id">
          </mat-form-field>
          <mat-form-field appearance="fill">
            <mat-label>Fecha</mat-label>
            <input matInput [matDatepicker]="modificarPicker" formControlName="fecha">
            <mat-datepicker-toggle matSuffix [for]="modificarPicker"></mat-datepicker-toggle>
            <mat-datepicker #modificarPicker></mat-datepicker>
          </mat-form-field>
          <mat-form-field appearance="fill">
            <mat-label>Hora</mat-label>
            <input matInput type="time" formControlName="hora">
          </mat-form-field>
          <mat-form-field appearance="fill">
            <mat-label>Estado</mat-label>
            <mat-select formControlName="estado">
              <mat-option value="PENDIENTE">PENDIENTE</mat-option>
              <mat-option value="ACEPTADA">ACEPTADA</mat-option>
              <mat-option value="RECHAZADA">RECHAZADA</mat-option>
              <mat-option value="CANCELADA">CANCELADA</mat-option>
            </mat-select>
          </mat-form-field>
          <button mat-raised-button color="primary" type="submit">Modificar Cita</button>
        </form>
      </div>
      <div *ngIf="activeSection === 'visualizar-consultas'">
        <h2>Visualizar consultas</h2>
        <table mat-table [dataSource]="consultas" class="mat-elevation-z8">
          
          <ng-container matColumnDef="id">
            <th mat-header-cell *matHeaderCellDef> ID </th>
            <td mat-cell *matCellDef="let consulta"> {{consulta.id}} </td>
          </ng-container>
          <ng-container matColumnDef="fecha">
            <th mat-header-cell *matHeaderCellDef> Fecha </th>
            <td mat-cell *matCellDef="let consulta"> {{consulta.fecha | date}} </td>
          </ng-container>
          <ng-container matColumnDef="hora">
            <th mat-header-cell *matHeaderCellDef> Hora </th>
            <td mat-cell *matCellDef="let consulta"> {{consulta.hora}} </td>
          </ng-container>
          <ng-container matColumnDef="estado">
            <th mat-header-cell *matHeaderCellDef> Estado </th>
            <td mat-cell *matCellDef="let consulta"> {{consulta.estado}} </td>
          </ng-container>
          <ng-container matColumnDef="pacienteNombre">
            <th mat-header-cell *matHeaderCellDef> Paciente </th>
            <td mat-cell *matCellDef="let consulta"> {{consulta.pacienteNombre}} </td>
          </ng-container>
        
          
          <ng-container matColumnDef="acciones">
            <th mat-header-cell *matHeaderCellDef> Acciones </th>
            <td mat-cell *matCellDef="let consulta">
              <button mat-button color="primary" (click)="aceptarCita(consulta.id)">Aceptar</button>
              <button mat-button color="warn" (click)="rechazarCita(consulta.id)">Rechazar</button>
              <button mat-button color="warn" (click)="deleteCita(consulta.id)">Eliminar</button>
            </td>
           
          </ng-container>
        
          <tr mat-header-row *matHeaderRowDef="mostrarConsultas"></tr>
          <tr mat-row *matRowDef="let row; columns: mostrarConsultas;"></tr>
        </table>
      </div>
      <div *ngIf="activeSection === 'datos-usuario'">
        <h2>Datos del usuario</h2>
        <mat-card>
          <mat-card-header>
            <mat-card-title>Información del Usuario</mat-card-title>
          </mat-card-header>
          <mat-card-content>
            <p><strong>Nombre:</strong> {{usuarioForm.get('nombre')?.value}}</p>
            <p><strong>Email:</strong> {{usuarioForm.get('email')?.value}}</p>
            <p><strong>Teléfono:</strong> {{usuarioForm.get('telefono')?.value}}</p>
            <p><strong>Rol:</strong> {{usuarioForm.get('rol')?.value}}</p>
          </mat-card-content>
          <mat-card-actions>
            <button mat-raised-button color="primary" (click)="editMode = true">Editar</button>
          </mat-card-actions>
        </mat-card>
        <form *ngIf="editMode" [formGroup]="usuarioForm" (ngSubmit)="actualizarUsuario()">
          <mat-form-field appearance="fill">
            <mat-label>Nombre</mat-label>
            <input matInput formControlName="nombre">
          </mat-form-field>
          <mat-form-field appearance="fill">
            <mat-label>Email</mat-label>
            <input matInput formControlName="email">
          </mat-form-field>
          <mat-form-field appearance="fill">
            <mat-label>Teléfono</mat-label>
            <input matInput formControlName="telefono">
          </mat-form-field>
          <mat-form-field appearance="fill">
            <mat-label>Contraseña</mat-label>
            <input matInput type="password" formControlName="password">
          </mat-form-field>
          <mat-form-field appearance="fill">
            <mat-label>Rol</mat-label>
            <mat-select formControlName="rol">
              <mat-option value="MEDICO">Médico</mat-option>
              <mat-option value="PACIENTE">Paciente</mat-option>
            </mat-select>
          </mat-form-field>
          <button mat-raised-button color="primary" type="submit">Actualizar Datos</button>
          <button mat-raised-button color="warn" (click)="deleteUsuario()">Eliminar Usuario</button>
          <button mat-raised-button (click)="editMode = false">Cancelar</button>
        </form>
      </div>
    </div>
  </mat-sidenav-content>
</mat-sidenav-container>